<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:t="http://back.rolsac2.caib.es/tags">
<!--
Pàgina amb el llistat de processos automàtics
-->
<ui:composition template="/WEB-INF/templates/layout.xhtml">
    <ui:define name="metadata">
        <f:metadata>
            <!--<f:viewParam id="unitatId" name="unitatId" value="#{unitatModel.value.id}" />-->
            <f:viewAction action="#{viewProcesosSolr.load}" />
        </f:metadata>
    </ui:define>

    <ui:define name="pageTitle">
        <h:outputFormat value="#{labels['viewProcesosSolr.titulo.pagina']}"/>
    </ui:define>

    <ui:define name="breadcrumb">
        <c:forEach var="ua" items="#{sessionBean.getUnidadesAdministrativasActivas()}">
            <p:menuitem value="#{ua.nombre.getTraduccion(sessionBean.lang)}"
                        action="#{sessionBean.cambiarUnidadAdministrativa(ua)}" update="migaPan"
                        oncomplete="$('#form:actualizarBusqueda').click();">
            </p:menuitem>
        </c:forEach>
    </ui:define>

    <ui:define name="content">
        <h:form>
            <p:tabView>
            <p:tab title="#{labels['viewProcesosSolr.tab.procedimientosEjecutados']}">
                <p:commandButton value="#{labels['viewProcesosSolr.refrescarDatos']}" icon="pi pi-refresh" iconPos="top"
                                 actionListener="#{viewProcesosSolr.buscar()}" styleClass="mb5"
                                 process="@this" update="dataTable dataTablePendientes messages">
                </p:commandButton>

                <p:dataTable id="dataTable" value="#{viewProcesosSolr.lazyModelLogs}" var="proceso"
                             paginator="true" lazy="true" filterDelay="300" widgetVar="procesosTable"
                             rows="#{viewProcesosSolr.filtro.paginaTamanyo}" rowsPerPageTemplate="10,20,50,100"
                             first="#{viewProcesosSolr.filtro.paginaFirst}"
                             paginatorPosition="bottom" paginatorAlwaysVisible="true"
                             paginatorTemplate="{RowsPerPageLabel} {RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport}
                             {NextPageLink} {LastPageLink}"
                             currentPageReportTemplate="#{labels.dataTable_currentPageReport}"
                             emptyMessage="#{labels['dict.noHayDatos']}"
                             selectionMode="single" selection="#{viewProcesosSolr.datoSeleccionado}"
                             rowKey="#{proceso.codigo}"
                             reflow="true"
                             sortBy="#{viewProcesosSolr.filtroLog.orderBy}"
                             sortOrder="#{viewProcesosSolr.filtroLog.order}"
                             style="min-height: 300px;"
                >
                    <p:ajax
                            event="rowDblselect"
                            oncomplete="triggerDblClick();"
                            global="false"/>
                    <p:ajax event="rowSelect" />
                    <!--<p:ajax event="rowSelect" update="btnLanzar" />-->

                    <f:facet name="{RowsPerPageLabel}">
                        #{labels.dataTable_rowsPerPage}
                    </f:facet>
                    <p:column headerText="#{labels['dict.descripcion']}" styleClass="w140px">
                        <f:facet name="header"/>
                        <h:outputText value="#{proceso.proceso.descripcion}"/>
                    </p:column>
                    <p:column headerText="#{labels['dict.fechaInicio']}" styleClass="w160px">
                        <f:facet name="header"/>
                        <h:outputText value="#{proceso.fechaInicio}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{labels['dict.fechaFin']}" styleClass="w160px">
                        <f:facet name="header"/>
                        <h:outputText value="#{proceso.fechaFin}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{labels['dict.activo']}" styleClass="w130px">
                        <f:facet name="header"/>
                        <p:selectBooleanCheckbox value="#{proceso.proceso.activo}" disabled="true"></p:selectBooleanCheckbox>
                    </p:column>
                    <p:column headerText="#{labels['dict.resultado']}">
                        <f:facet name="header"/>
                        <h:outputText value="#{proceso.getListaPropiedadesPlano()}" escape="false" style="white-space:pre-line;" />
                    </p:column>
                    <p:column headerText="" styleClass="w50px">
                        <p:commandButton value="" icon="pi pi-align-center" iconPos="center"
                                         actionListener="#{viewProcesosSolr.verErrores(proceso.codigo)}"
                                         process="@this" update="messages" styleClass="h30px w30px">
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:tab>
            <p:tab title="#{labels['viewProcesosSolr.tab.datosPendientes']}">
                <p:commandButton value="#{labels['viewProcesosSolr.refrescarDatos']}" icon="pi pi-refresh" iconPos="top"
                                 actionListener="#{viewProcesosSolr.buscar()}" styleClass="mb5"
                                 process="@this" update="dataTable dataTablePendientes messages">
                </p:commandButton>
            <p:dataTable id="dataTablePendientes" value="#{viewProcesosSolr.lazyModel}" var="proceso"
                         paginator="true" lazy="true" filterDelay="300" widgetVar="procesosTable"
                         rows="#{viewProcesosSolr.filtro.paginaTamanyo}" rowsPerPageTemplate="10,20,50,100"
                         first="#{viewProcesosSolr.filtro.paginaFirst}"
                         paginatorPosition="bottom" paginatorAlwaysVisible="true"
                         paginatorTemplate="{RowsPerPageLabel} {RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport}
                         {NextPageLink} {LastPageLink}"
                         currentPageReportTemplate="#{labels.dataTable_currentPageReport}"
                         emptyMessage="#{labels['dict.noHayDatos']}"
                         selectionMode="single" selection="#{viewProcesosSolr.datoSeleccionado}"
                         rowKey="#{proceso.codigo}"
                         reflow="true"
                         sortBy="#{viewProcesosSolr.filtro.orderBy}"
                         sortOrder="#{viewProcesosSolr.filtro.order}"
                         style="min-height: 200px;"
>
                <p:ajax
                        event="rowDblselect"
                        oncomplete="triggerDblClick();"
                        global="false"/>
                <f:facet name="{RowsPerPageLabel}">
                    #{labels.dataTable_rowsPerPage}
                </f:facet>
                <p:column sortBy="#{proceso.codigo}" headerText="#{labels['dict.codigo']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{proceso.codigo}"/>
                </p:column>
                <p:column sortBy="#{proceso.tipo}" headerText="#{labels['dict.tipo']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{labels['viewProcesosSolr.tipo.' += proceso.tipo] }"/>
                </p:column>
                <p:column sortBy="#{proceso.accion}" headerText="#{labels['dict.accion']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{labels['viewProcesosSolr.accion.' += proceso.accion] }"/>
                </p:column>
                <p:column sortBy="#{proceso.tipo}" headerText="#{labels['dict.codigoElemento']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{proceso.codElemento}"/>
                </p:column>
                <p:column sortBy="#{proceso.fechaCreacion}" headerText="#{labels['dict.fechaCreacion']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{proceso.fechaCreacion}"/>
                </p:column>
                <p:column sortBy="#{proceso.fechaIntentoIndexacion}" headerText="#{labels['dict.fechaIntentoIndexacion']}"  styleClass="w160px">
                    <f:facet name="header"/>
                    <h:outputText value="#{proceso.fechaIntentoIndexacion}"/>
                </p:column>
                <p:column headerText="#{labels['dict.mensaje']}">
                    <f:facet name="header"/>
                    <h:outputText value="#{proceso.mensajeError}"/>
                </p:column>
            </p:dataTable>
            </p:tab>
            </p:tabView>


            <p:panel id="form">
            <div class="row">
                <div class="ui-g-3 ui-md-3 ui-lg-3 text-end text-align-right pt10 mr5">
                        <p>
                            <h:outputText value="#{labels['viewProcesosSolr.indexar']}:" />
                        </p>
                </div>
                <div class="ui-g-8 ui-md-8 ui-lg-8">
                        <p:commandButton value="#{labels['viewProcesosSolr.indexarProcedimientos']}" icon="pi pi-file-o" iconPos="top"
                                         actionListener="#{viewProcesosSolr.indexarProcedimientos()}" styleClass="mr10"
                                         process="@this" update="messages">
                        </p:commandButton>
                        <p:commandButton value="#{labels['viewProcesosSolr.indexarServicios']}" icon="pi pi-file-o" iconPos="top"
                                         actionListener="#{viewProcesosSolr.indexarServicios()}" styleClass="mr10"
                                         process="@this" update="messages">
                        </p:commandButton>
                        <p:commandButton value="#{labels['viewProcesosSolr.indexarNormativas']}" icon="pi pi-file-o" iconPos="top"
                                         actionListener="#{viewProcesosSolr.indexarNormativas()}" styleClass="mr10"
                                         process="@this" update="messages">
                        </p:commandButton>
                        <p:commandButton value="#{labels['viewProcesosSolr.indexarUAs']}" icon="pi pi-file-o" iconPos="top"
                                         actionListener="#{viewProcesosSolr.indexarUAs()}"
                                         process="@this" update="messages">
                        </p:commandButton>
                </div>
            </div>
            <div class="row">

                <div class="ui-g-3 ui-md-3 ui-lg-3 text-align-right pt10 mr5">
                    <p>
                        <h:outputText value="#{labels['viewProcesosSolr.pendientes']}:" />
                    </p>
                 </div>
                <div class="ui-g-8 ui-md-8 ui-lg-8">
                    <p:commandButton value="#{labels['viewProcesosSolr.indexarPendientes']}" icon="pi pi-file-o" iconPos="top"
                                     actionListener="#{viewProcesosSolr.indexarPendientes()}"
                                     process="@this" update="messages">
                    </p:commandButton>
                </div>
            </div>
            <div class="row">

                <div class="ui-g-3 ui-md-3 ui-lg-3 text-align-right pt10 ">
                    <p>
                        <h:outputText value="#{labels['viewProcesosSolr.desindexar']}:" />
                    </p>
                </div>
                <div class="ui-g-8 ui-md-8 ui-lg-8">
                    <p:commandButton value="#{labels['viewProcesosSolr.desindexarTodo']}" icon="pi pi-file-o" iconPos="top"
                                     actionListener="#{viewProcesosSolr.desindexarTodo()}" styleClass="mr10"
                                     process="@this" update="messages">
                    </p:commandButton>
                    <p:commandButton value="#{labels['viewProcesosSolr.desindexarCaducadas']}" icon="pi pi-file-o" iconPos="top"
                                     actionListener="#{viewProcesosSolr.desindexarCaducadas()}"
                                     process="@this" update="messages">
                    </p:commandButton>
                </div>
            </div>

             </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
</html>
