<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
>
<ui:composition template="/WEB-INF/templates/layoutDialog.xhtml">
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam id="MODO_ACCESO" name="MODO_ACCESO" value="#{dialogPlugins.modoAcceso}"/>
            <f:viewParam id="ID" name="ID" value="#{dialogPlugins.id}"/>
            <f:viewAction action="#{dialogPlugins.load}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="pageTitleDialog">
        <h:outputFormat value="#{labels['dialogPlugins.consulta']}"
                        rendered="#{dialogPlugins.isModoConsulta()}"/>
        <h:outputFormat value="#{labels['dialogPlugins.detalle']}"
                        rendered="#{dialogPlugins.isModoEdicion()}"/>
        <h:outputFormat value="#{labels['dialogPlugins.nuevo']}"
                        rendered="#{dialogPlugins.isModoAlta()}"/>
    </ui:define>
    <ui:define name="contentDialog">
        <p:panel id="form">
            <p:growl id="messagesDialog"
                     globalOnly="false"
                     showDetail="false"
                     life="5000"
                     escape="false"/>
            <div class="row">
                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <h:outputText value="#{labels['dict.codigo']}:" for="txtCodigo"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:inputText id="txtCodigo" value="#{dialogPlugins.data.codigo}"
                                 styleClass="w95" disabled="true" maxlength="50"/>
                </div>

                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <p:outputLabel value="#{labels['dict.tipo']}:" for="txtTipo"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:selectOneMenu id="txtTipo" requiredMessage="#{labels['dict.obligatorio.tipo']}"
                                     required="#{empty param['formDialog:closeButton']}" value="#{dialogPlugins.data.tipo}"
                                     disabled="#{dialogPlugins.isModoConsulta()}">
                        <f:selectItem itemValue="" itemLabel="#{labels['dialogPlugins.sinPlugin']}"/>
                        <!--<f:selectItem itemValue="BOL" itemLabel="#{labels['dialogPlugins.plugin.BOL']}"/>
                        <f:selectItem itemValue="TRA" itemLabel="#{labels['dialogPlugins.plugin.DI3']}"/>
                        <f:selectItem itemValue="DI3" itemLabel="#{labels['dialogPlugins.plugin.DI3']}"/>-->
                        <f:selectItems value="#{dialogPlugins.tiposPlugin}" var="plugin" itemValue="#{plugin}"
                                       itemLabel="#{labels['dialogPlugins.plugin.' += plugin]}"></f:selectItems>
                        <p:ajax event="valueChange" process="@this" update="seleccionNormativa"></p:ajax>

                    </p:selectOneMenu>
                </div>

                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <p:outputLabel value="#{labels['dialogPlugins.descripcion']}:" for="txtDescripcion"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:inputText id="txtDescripcion" value="#{dialogPlugins.data.descripcion}"
                                 requiredMessage="#{labels['dict.obligatorio.descripcion']}"
                                 styleClass="w95" required="#{empty param['formDialog:closeButton']}"
                                 disabled="#{dialogPlugins.isModoConsulta()}" maxlength="50"/>
                </div>

                <!--
                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <h:outputText value="#{labels['dict.entidad']}:" for="selectEntidad"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:selectOneMenu id="selectEntidad" value="#{dialogPlugins.data.entidad}"
                                     styleClass="w95" required="true"
                                     disabled="#{dialogPlugins.isModoConsulta()}"
                                     converter="#{entidadConverter}">
                        <f:selectItem itemLabel="#{labels['dict.selecciona.entidad']}" itemValue="#{null}"/>
                        <f:selectItems value="#{dialogPlugins.entidadesActivas}" var="entidad"
                                       itemLabel="#{entidad.dir3}" itemValue="#{entidad}"/>
                    </p:selectOneMenu>
                </div> -->

                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <p:outputLabel value="#{labels['dialogPlugins.classname']}:" for="txtClassname"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:inputTextarea id="txtClassname" value="#{dialogPlugins.data.classname}"
                                     requiredMessage="#{labels['dict.obligatorio.classname']}"
                                     styleClass="w95" required="#{empty param['formDialog:closeButton']}"
                                     rows="3" autoResize="false"
                                     disabled="#{dialogPlugins.isModoConsulta()}" maxlength="1000"/>
                </div>

                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <p:outputLabel value="#{labels['dialogPlugins.prefijo']}:" for="txtPrefijo"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5">
                    <p:inputText id="txtPrefijo" value="#{dialogPlugins.data.prefijoPropiedades}"
                                 styleClass="w95"
                                 disabled="#{dialogPlugins.isModoConsulta()}" maxlength="100"/>
                </div>

                <h:panelGroup id="seleccionNormativa" style="display: inline-block; width: 100%">
                    <c:if test="#{dialogPlugins.data.tipo.equals('BOL')}">
                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                            <p:outputLabel value="#{labels['dialogNormativa.tipoBoletin']}:"
                                           for="selectTipoBoletin"/>
                        </div>
                        <div class="ui-g-12 ui-md-10 ui-lg-5">
                            <p:selectOneMenu id="selectTipoBoletin" value="#{dialogPlugins.boletinSeleccionado}"
                                             required="#{empty param['formDialog:closeButton']}"
                                             requiredMessage="#{labels['dict.obligatorio.boletinOficial']}"
                                             disabled="#{dialogPlugins.isModoConsulta()}"
                                             converter="#{boletinOficialConverter}">
                                <f:selectItem itemLabel="#{labels['dialogNormativa.selecciona.boletinOficial']}"
                                              itemValue="#{null}"/>
                                <f:selectItems value="#{dialogPlugins.tiposBoletin}" var="tipoBoletin"
                                               itemLabel="#{tipoBoletin.nombre}"
                                               itemValue="#{tipoBoletin}"/>
                                <p:ajax event="change" update="@this"></p:ajax>
                            </p:selectOneMenu>
                        </div>
                    </c:if>
                </h:panelGroup>


                <div class="ui-g-12 ui-md-2 ui-lg-1">
                    <p:outputLabel value="#{labels['dialogPlugins.propiedades']}:" for="dataTablePropiedades"/>
                </div>
                <div class="ui-g-12 ui-md-10 ui-lg-5 d-flex">
                    <p:dataTable id="dataTablePropiedades" var="td" value="#{dialogPlugins.data.propiedades}"
                                 rows="25" scrollable="true" style=" margin-right:0px !important;  flex: 1;"
                                 paginator="false" selectionMode="single"
                                 selection="#{dialogPlugins.propiedadSeleccionada}" rowKey="#{td.codigo}">

                        <!-- Necesario para actualizar en controlador la fila seleccionada -->
                        <p:ajax event="rowSelect" global="false"/>
                        <p:ajax event="rowUnselect"/>
                        <p:ajax event="rowDblselect"
                                oncomplete="rcEditarPropiedad();"
                                disabled="#{dialogPlugins.modoAcceso=='TypeModoAcceso.CONSULTA'}"
                        />

                        <!-- Columnas -->
                        <p:column headerText="#{labels['dialogPropiedades.codigo']}" class="ui-panelgrid-cell">
                            <h:outputText value="#{td.codigo}"/>
                        </p:column>

                        <p:column headerText="#{labels['dialogPropiedades.valor']}" class="ui-panelgrid-cell">
                            <h:outputText value="#{td.valor}"/>
                        </p:column>

                    </p:dataTable>
                    <div class="w5 ml-2 d-flex flex-column align-items-center g-5">
                        <p:commandButton id="btnNuevaPropiedad" icon="fa fa-plus"
                                         title="#{msg['botones.nuevo']}"
                                         actionListener="#{dialogPlugins.nuevaPropiedad()}" process="@this"
                                         update="messagesDialog"
                                         rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}"
                                         styleClass="p-2">
                            <p:ajax event="dialogReturn" listener="#{dialogPlugins.returnDialogo}"
                                    update="messagesDialog dataTablePropiedades"/>
                        </p:commandButton>
                        <p:commandButton id="btnEditarPropiedad" icon="fa fa-edit"
                                         title="#{msg['botones.editar']}"
                                         actionListener="#{dialogPlugins.editarPropiedad()}" process="@this"
                                         update="messagesDialog"
                                         rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}"
                                         styleClass="p-2">
                            <p:ajax event="dialogReturn" listener="#{dialogPlugins.returnDialogo}"
                                    update="messagesDialog dataTablePropiedades"/>
                        </p:commandButton>
                        <p:commandButton id="btnEliminarPropiedad" icon="fa fa-minus"
                                         title="#{msg['botones.eliminar']}"
                                         actionListener="#{dialogPlugins.quitarPropiedad()}" process="@this"
                                         update="messagesDialog dataTablePropiedades"
                                         rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}"
                                         styleClass="p-2"/>
                        <p:commandButton icon="fa fa-arrow-up" title="#{msg['botones.subir']}"
                                         actionListener="#{dialogPlugins.subirPropiedad()}" process="@this"
                                         update="messagesDialog dataTablePropiedades"
                                         rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}"
                                         styleClass="p-2"/>
                        <p:commandButton icon="fa fa-arrow-down" title="#{msg['botones.bajar']}"
                                         actionListener="#{dialogPlugins.bajarPropiedad()}" process="@this"
                                         update="messagesDialog dataTablePropiedades"
                                         rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}"
                                         styleClass="p-2"/>

                    </div>
                </div>
            </div>
        </p:panel>
        <h:outputScript rendered="#{dialogPlugins.modoAcceso!='TypeModoAcceso.CONSULTA'}">
            function rcEditarPropiedad() {
                document.getElementById("formDialog:btnEditarPropiedad").click();
            }

            function rcBorrarPropiedad() {
                document.getElementById("formDialog:btnEliminarPropiedad").click();
            }
        </h:outputScript>
    </ui:define>
    <ui:define name="contentFooterDialogRight">
        <p:commandButton action="#{dialogPlugins.ayuda}"
                         icon="pi pi-info-circle" iconPos="top"
                         value="#{labels['dict.ayuda']}"
                         process="@this"/>
        <p:commandButton action="#{dialogPlugins.guardar}"
                         value="#{labels['dict.guardar']}" update="messagesDialog form"
                         process="@all"/>
        <p:commandButton action="#{dialogPlugins.cerrar}" id="closeButton"
                         value="#{labels['dict.cerrar']}" update="messagesDialog"
                         process="@all" oncomplete="stopCargando()" onstart="startCargando()"/>
        <p:confirmDialog showEffect="fade" hideEffect="fade" header="#{labels['dict.cerrar.cambiosSinGuardar.titulo']}"
                         update="messagesDialog form" responsive="true" width="458px"
                         message="#{labels['dict.cerrar.cambiosSinGuardar.mensaje']}" widgetVar="confirmCerrar">
            <p:commandButton value="Sí" process="@this" action="#{dialogPlugins.cerrarDefinitivo}"
                             oncomplete="PF('confirmCerrar').hide();"/>
            <p:commandButton value="No" onclick="PF('confirmCerrar').hide();"/>
        </p:confirmDialog>
    </ui:define>
</ui:composition>
</html>