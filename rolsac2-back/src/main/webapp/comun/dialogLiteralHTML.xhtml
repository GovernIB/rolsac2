<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:t="http://back.rolsac2.caib.es/tags">
<!--
Pàgina amb el llistat de personal d'una unitat administrativa.
-->
<ui:composition template="/WEB-INF/templates/layoutDialog.xhtml">

    <ui:define name="metadata">
        <!-- Parametros dialogo -->
		<f:metadata>
			<f:viewParam name="MODO_ACCESO" value="#{dialogLiteralHTML.modoAcceso}" />
			<f:viewParam id="ID" name="ID" value="#{dialogLiteralHTML.id}" />
			<f:viewParam name="idioma" value="#{dialogLiteralHTML.idiomaInicial}" />
			<f:viewAction action="#{dialogLiteralHTML.load}" />
			<f:event type="preRenderView" listener="#{dialogLiteralHTML.onload}" />
		</f:metadata>
    </ui:define>

	 <ui:define name="icerik">
    	<script src="../tinymce/js/tinymce/tinymce.min.js" type="text/javascript"></script>
    	<script type="text/javascript">


    	tinyMCE.init({
 		   // General options
 		    mode : "textareas",
 		    height: 559,
 		    plugins: "code image link lists paste textcolor",
 		    toolbar: "bold italic | forecolor backcolor | link image | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat #{dialogLiteralHTML.sourceCode}" ,
 		    menubar: "",
 		    paste_as_text : false,
 		   	readonly: #{dialogLiteralHTML.isConsulta()},
 		 });

	var idioma = 'es';
    /** Organiza los tabs. **/
    function mostrar(idioma) {
    	mostrarTab(idioma);
    	mostrarButton(idioma);
    }

   /** Funcion que muestra el tab con la traducción de cada idioma ***/
   function mostrarButton(idioma) {
	    ocultarButton("formDialog:btnCa");
	    ocultarButton("formDialog:btnEs");


	   	if (idioma == 'ca') {
	   		document.getElementById("formDialog:btnCa").classList.add("marcado");
	   		return;
	   	}
	   	if (idioma == 'es') {
	   		document.getElementById("formDialog:btnEs").classList.add("marcado");
	   		return;
	   	}
   }

   /** Ocultar button. **/
   function ocultarButton(elId) {
	   	if (document.getElementById(elId) != null) {
	   		document.getElementById(elId).classList.remove("marcado");
	   	}
   }

    /** Funcion que muestra el tab con la traducción de cada idioma ***/
    function mostrarTab(idioma) {
    	ocultarTab("formDialog:txtCA");
    	ocultarTab("formDialog:txtES");

    	if (idioma == 'ca') {
    		document.getElementById("formDialog:txtCA").parentNode.style.display="";
    		document.getElementById("formDialog:btnCa").firstChild.style.background = "#e0d7da";
    		document.getElementById("formDialog:btnEs").firstChild.style.background = "#f5f5f5";
    		console.log(document.getElementById("formDialog:btnEs").firstChild);

    		return;
    	}
    	if (idioma == 'es') {
    		document.getElementById("formDialog:txtES").parentNode.style.display="";
    		document.getElementById("formDialog:btnEs").firstChild.style.background = "#e0d7da";
    		document.getElementById("formDialog:btnCa").firstChild.style.background = "#f5f5f5";
    		return;
    	}

    }

    /** Ocultar tab. **/
    function ocultarTab(elId) {
    	if (document.getElementById(elId) != null) {
    		document.getElementById(elId).parentNode.style.display="none";
    	}
    }

    var visibleCa = #{dialogLiteralHTML.visibleCa};
    var visibleEs = #{dialogLiteralHTML.visibleEs};

    function guardar() {
    	if (visibleCa) {
    		if (!checkTiny("formDialog:txtCA")) {
				document.getElementById("formDialog:btnCa").click();
    			return;
    		}
    	}
    	if (visibleEs) {
    		if (!checkTiny("formDialog:txtES")) {
				document.getElementById("formDialog:btnEs").click();
    			return;
    		}
    	}

    	document.getElementById("formDialog:btnGuardar").click();

    }

    /** Comprueba si esta vacio, En caso de no estarlo, rellena el campo. **/
    function checkTiny(id) {
    	var correcto = false;
    	var contenido = tinyMCE.get(id).getContent();
    	if (isVacio(contenido)) {
    		correcto = false;
    	} else {
    		correcto = true;
    		document.getElementById(id).value = contenido;
    	}
    	return correcto;
    }

  //<![CDATA[
    function isVacio(texto)  {
    	while (texto.indexOf('&nbsp;') >= 0) {
    		texto = texto.replace('&nbsp;',"");
    	}
    	while (texto.indexOf('</p>') >= 0) {
    		texto = texto.replace('</p>',"");
    	}
    	while (texto.indexOf('<p>') >= 0) {
    		texto = texto.replace('<p>',"");
    	}
    	while (texto.indexOf('\n') >= 0) {
    		texto = texto.replace('\n',"");
    	}
    	texto = texto.trim();
    	if (texto == '') {
    		return true;
   		}
    	return false;
    }
  //]]>
    </script>
  </ui:define>

    <ui:define name="pageTitleDialog">
        Gestión de literales HTML
    </ui:define>


    <ui:define name="contentDialog" >
        <p:panel onload="mostrar('#{dialogLiteralHTML.idiomaInicial}')" id="panelIdiomas">
				<p:growl id="growlDialogTraduccion"  globalOnly="false"
								                     showDetail="true"
								                     life="5000"
								                     process="@all"
								                     escape="false"/>

						<div class="ui-inputgroup" align="center" style="margin-top:5px;margin-bottom:5px">
            				<p:commandButton id="btnCa" value="#{labels['dict.textoCa']}"  oncomplete="mostrar('ca')" process="@this" style="outline:none !important;" actionListener="dialogLiteralHTML.setIdioma('es')"/>
            				<p:commandButton id="btnEs" value="#{labels['dict.textoEs']}"  oncomplete="mostrar('es')" process="@this" style="outline:none !important;" actionListener="dialogLiteralHTML.setIdioma('ca')"/>
        				</div>

        				<div style="margin:10px" rendered="#{dialogLiteralHTML.visibleCa}" >
							<p:inputTextarea id="txtCA" value="#{dialogLiteralHTML.textoCA}" disabled="#{dialogLiteralHTML.isConsulta()}" rows="14" cols="140" autoResize="false" maxlength="4000" style="height:559px"  />
						</div>
						<div style="margin:10px; height:559px !important" rendered="#{dialogLiteralHTML.visibleEs}">
							<p:inputTextarea id="txtES" value="#{dialogLiteralHTML.textoES}" disabled="#{dialogLiteralHTML.isConsulta()}" rows="14" cols="140" autoResize="false" class="alturas"  maxlength="4000" style="height:559px !important;"/>
						</div>

				</p:panel>
	</ui:define>



    <ui:define name="contentFooterDialogLeft">
        <p:commandButton  action="#{dialogLiteralHTML.ayuda}"
                          icon="pi pi-info-circle" iconPos="top"
                         value="#{labels['dict.ayuda']}"
                         process="@this" />
    </ui:define>
    <ui:define name="contentFooterDialogRight">

						<p:commandButton id="btnGuardar" value="#{labels['dict.aceptar']}" onclick="tinyMCE.triggerSave(true,true);" rendered="#{!dialogLiteralHTML.isConsulta()}" process="@all" update="formDialog:growlDialogTraduccion" action="#{dialogLiteralHTML.guardar()}" styleClass="boton-azul"/>
						<p:commandButton value="#{labels['dict.borrar']}" actionListener="#{dialogLiteralHTML.borrar()}" process="@this"  rendered="#{!dialogLiteralHTML.isConsulta()}" tyleClass="boton-rojo"/>
						<p:commandButton value="#{labels['dict.cancelar']}" actionListener="#{dialogLiteralHTML.cancelar()}" process="@this"/>

			<p:commandButton id="btnErrorCa" actionListener="#{dialogLiteralHTML.errorCa()}" update="formDialog:growlDialogTraduccion" style="display:none" process="@this"/>
			<p:commandButton id="btnErrorEs" actionListener="#{dialogLiteralHTML.errorEs()}" update="formDialog:growlDialogTraduccion" style="display:none" process="@this"/>

    </ui:define>

</ui:composition>
</html>
