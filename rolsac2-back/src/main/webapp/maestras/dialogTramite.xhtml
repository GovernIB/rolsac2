<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:my="http://java.sun.com/jsf/composite/components"
>

<ui:composition template="/WEB-INF/templates/layoutDialog.xhtml">

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam id="MODO_ACCESO" name="MODO_ACCESO" value="#{dialogProcedimientoTramite.modoAcceso}"/>
            <f:viewParam id="ID" name="ID" value="#{dialogProcedimientoTramite.id}"/>
            <f:viewAction action="#{dialogProcedimientoTramite.load}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="pageTitleDialog">
        <h:outputFormat value="Nuevo Trámite "/>
    </ui:define>
    <ui:define name="contentDialog">
        <p:panel header="Prueba">
            <p>Prueba a ver si funciona correctamente el update</p>
        </p:panel>
    </ui:define>
    <ui:define name="contentIdioma">

        <span class="pi pi-tag mt-1"/>
        <h:outputText value="#{labels['dict.idioma']}:" styleClass="mr-1 mt-1"/>
        <p:selectOneButton id="opcionIdioma" value="#{dialogProcedimientoTramite.idioma}" styleClass="botoneraRed">
            <f:selectItem itemLabel="#{labels['dict.catalan']}" itemValue="ca"/>
            <f:selectItem itemLabel="#{labels['dict.castellano']}" itemValue="es"/>
            <p:ajax update="" process="@this"/>
        </p:selectOneButton>
        <p:commandButton action="#{dialogProcedimientoTramite.traducir}"
                         icon="pi pi-compass" iconPos="top"
                         value="#{labels['dict.traducir']}"
                         style="margin-left:10px"
                         update=""
                         process="@this"/>
    </ui:define>

    <ui:define name="contentDialog">
        <p:growl id="messagesDialog"
                 globalOnly="false"
                 showDetail="true"
                 life="5000"
                 escape="false"/>
        <div class="ui-g-12 ui-md-12 px-4 panel-container">
            <p:panel header="EDICIÓN TRÁMITE DEL PROCEDIMIENTO">
                <div class="form-row">
                    <div class="form-group">
                        <h6 class="font-weight-bold mt-3">#{dialogProcedimiento.data.nombre.getTraduccion(sessionBean.lang)}</h6>
                    </div>
                </div>
            </p:panel>
            <p:panel header="DATOS">
                <div class="form-row">
                    <div class="form-group col-md-2">
                        <p class="mb-1">
                            <h:outputText styleClass="mb-1" value="Código:" for="txtCodigo"/>
                        </p>
                        <p:inputText id="txtCodigo" value="#{dialogProcedimientoTramite.data.codigo}"
                                     styleClass="w95" disabled="true"/>
                    </div>
                    <div class="form-group col-md-2">
                        <p:outputLabel value="Fecha de publicación:" for="txtFechaPublicacion"
                                       styleClass="mb-1 pt-0"/>
                        <p>
                            <p:calendar id="txtFechaPublicacion" styleClass="fecha"
                                        disabled="#{dialogProcedimientoTramite.isModoConsulta()}"
                                        value="#{dialogProcedimientoTramite.data.fechaPublicacion}"
                                        pattern="dd/MM/yyyy"
                                        required="true" showOn="button"/>
                        </p>
                    </div>
                    <div class="form-group col-md-2">
                        <p:outputLabel value="Fecha caducidad:" for="txtFechaInicio"
                                       styleClass="mb-1 pt-0"/>
                        <p>
                            <p:calendar id="txtFechaInicio" styleClass="fecha"
                                        disabled="#{dialogProcedimientoTramite.isModoConsulta()}"
                                        value="#{dialogProcedimientoTramite.data.fechaInicio}"
                                        pattern="dd/MM/yyyy" showOn="button"/>
                        </p>
                    </div>
                    <div class="form-group col-md-2">
                        <p:outputLabel value="Fecha caducidad:" for="txtFechaCierre"
                                       styleClass="mb-1 pt-0"/>
                        <p>
                            <p:calendar id="txtFechaCierre" styleClass="fecha"
                                        disabled="#{dialogProcedimientoTramite.isModoConsulta()}"
                                        value="#{dialogProcedimientoTramite.data.fechaCierre}"
                                        pattern="dd/MM/yyyy" showOn="button"/>
                        </p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Nombre del trámite:"
                                       for="txtNombre"/>
                        <p>
                            <my:literalComponent id="txtNombre" styleClass="w95"
                                                 value="#{dialogProcedimientoTramite.data.nombre}"
                                                 soloLecture="#{dialogProcedimientoTramite.isModoConsulta()}"
                                                 required="true"
                                                 idiomasObligatorios="#{sessionBean.getIdiomasObligatorios()}"
                                                 idiomasPermitidos="#{sessionBean.getIdiomasPermitidos()}"
                                                 idioma="#{dialogProcedimientoTramite.idioma}"
                                                 literal="#{dialogProcedimientoTramite.data.nombre}"/>
                        </p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Objeto:"
                                       for="txtRequisitos"/>
                        <p>
                            <my:literalComponent id="txtRequisitos" styleClass="w95"
                                                 value="#{dialogProcedimientoTramite.data.requisitos}"
                                                 soloLecture="#{dialogProcedimientoTramite.isModoConsulta()}"
                                                 required="true"
                                                 idiomasObligatorios="#{sessionBean.getIdiomasObligatorios()}"
                                                 idiomasPermitidos="#{sessionBean.getIdiomasPermitidos()}"
                                                 idioma="#{dialogProcedimientoTramite.idioma}"
                                                 literal="#{dialogProcedimientoTramite.data.requisitos}"/>
                        </p>

                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Documentación:"
                                       for="txtDocum"/>
                        <p>
                            <my:literalComponent id="txtDocum" styleClass="w95"
                                                 value="#{dialogProcedimientoTramite.data.documentacion}"
                                                 soloLecture="#{dialogProcedimientoTramite.isModoConsulta()}"
                                                 required="true"
                                                 idiomasObligatorios="#{sessionBean.getIdiomasObligatorios()}"
                                                 idiomasPermitidos="#{sessionBean.getIdiomasPermitidos()}"
                                                 idioma="#{dialogProcedimientoTramite.idioma}"
                                                 literal="#{dialogProcedimientoTramite.data.documentacion}"/>
                        </p>

                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Término máximo:"
                                       for="txtTermMax"/>
                        <p>
                            <my:literalComponent id="txtTermMax" styleClass="w95"
                                                 value="#{dialogProcedimientoTramite.data.terminoMaximo}"
                                                 soloLecture="#{dialogProcedimientoTramite.isModoConsulta()}"
                                                 required="true"
                                                 idiomasObligatorios="#{sessionBean.getIdiomasObligatorios()}"
                                                 idiomasPermitidos="#{sessionBean.getIdiomasPermitidos()}"
                                                 idioma="#{dialogProcedimientoTramite.idioma}"
                                                 literal="#{dialogProcedimientoTramite.data.terminoMaximo}"/>
                        </p>

                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Órgano competente para la tramitación:"
                                       for="txtOrgInstr"/>
                        <p>
                            <my:unidadAdministrativaComponent id="txtOrgInstr"
                                                              value="#{dialogProcedimientoTramite.data.unidadAdministrativa}"
                                                              idioma="#{dialogProcedimientoTramite.idioma}"
                                                              ocultarTexto="false" esCabecera="false"
                                                              required="true"
                            />
                        </p>
                    </div>
                </div>
            </p:panel>
            <p:panel header="CANALES DE PRESENTACIÓN">
            <div class="form-row align-items-center">
                <div class="form-group">
                    <!--Aquí es mapear luego con los bools que tiene TipoTramitacionDTO para ello-->
                    <p:selectManyCheckbox id="canalesTramitacion"
                                          value="#{dialogProcedimientoTramite.canalesSeleccionados}">
                        <f:selectItem itemLabel="Presencial" itemValue="PRE"/>
                        <f:selectItem itemLabel="Telemático" itemValue="TEL"/>
                        <f:selectItem itemLabel="Telefónico" itemValue="TLF"/>
                        <p:ajax update="txtTraPlantilla txtTraId txtTraVer txtTraPlat txtTraUrl txtTraParam"
                                event="change" listener="#{dialogProcedimientoTramite.cambiaTipo}"/>
                    </p:selectManyCheckbox>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-5">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Selección Plantilla Trámite:"
                                   for="txtTraPlantilla"/>

                    <p:selectOneMenu id="txtTraPlantilla"
                                     value="#{dialogProcedimientoTramite.plantillaSel}"
                                     styleClass="w95"
                                     disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                        !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                     converter="#{tipoTramitacionConverter}"
                    >
                        <f:selectItem itemLabel="#{labels['dialogUnidadAdministrativa.selecciona.tipo']}"
                                      itemValue="#{null}"/>
                        <f:selectItems value="#{dialogProcedimientoTramite.plantillasTipoTramitacion}" var="plantilla"
                                       itemLabel="#{plantilla.tramiteId}" itemValue="#{plantilla}"/>
                        <p:ajax update="txtTraId txtTraVer txtTraPlat txtTraUrl txtTraParam" event="change"
                                listener="#{dialogProcedimientoTramite.testEvento}"/>
                    </p:selectOneMenu>
                </div>
            </div>
            <div class="form-row">
                <div class="form-grup col-md-4">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Identificador:"
                                   for="txtTraId"/>
                    <p:inputText id="txtTraId"
                                 disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                    dialogProcedimientoTramite.plantillaSel != null ||
                                                    !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                 value="#{dialogProcedimientoTramite.canalPresentacion.tramiteId}"
                                 styleClass="w95"/>
                </div>
                <div class="form-grup col-md-2">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Versión:"
                                   for="txtTraVer"/>
                    <p:inputNumber id="txtTraVer"
                                   disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                    dialogProcedimientoTramite.plantillaSel != null ||
                                                    !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                   value="#{dialogProcedimientoTramite.canalPresentacion.tramiteVersion}"
                                   styleClass="w95"/>
                </div>
                <div class="form-grup  ml-2">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Plataforma de tramitación:"
                                   for="txtTraPlat"/>
                    <p:selectOneMenu id="txtTraPlat"
                                     value="#{dialogProcedimientoTramite.canalPresentacion.codPlatTramitacion}"
                                     styleClass="w95"
                                     disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                        dialogProcedimientoTramite.plantillaSel != null ||
                                                    !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                     converter="#{platTramitElectronicaConverter}">
                        <f:selectItem itemLabel="#{labels['dialogUnidadAdministrativa.selecciona.tipo']}"
                                      itemValue="#{null}"/>
                        <f:selectItems value="#{dialogProcedimientoTramite.platTramitElectronica}"
                                       var="plataforma"
                                       itemLabel="#{plataforma.descripcion.getTraduccion(sessionBean.lang)}"
                                       itemValue="#{plataforma}"/>
                    </p:selectOneMenu>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="URL trámite telemático:"
                                   for="txtTraUrl"/>
                    <p:inputText id="txtTraUrl"
                                 disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                    dialogProcedimientoTramite.plantillaSel != null ||
                                                    !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                 value="#{dialogProcedimientoTramite.canalPresentacion.urlTramitacion}"
                                 styleClass="w95"/>
                </div>
                <div class="form-grup col-md-6">
                    <p:outputLabel styleClass="mr-2 mb-1 pt-0" value="Parámetros:"
                                   for="txtTraParam"/>
                    <p:inputText id="txtTraParam"
                                 disabled="#{dialogProcedimientoTramite.isModoConsulta() ||
                                                    dialogProcedimientoTramite.plantillaSel != null ||
                                                    !dialogProcedimientoTramite.canalesSeleccionados.contains('TEL')}"
                                 value="#{dialogProcedimientoTramite.canalPresentacion.tramiteParametros}"
                                 styleClass="w95"/>
                </div>
            </div>
    </p:panel>
</div>


<h:outputScript>
    function rcEditarPropiedad() {
        document.getElementById("dialogPlugin:btnEditarPropiedad").click();
    }

    function rcBorrarPropiedad() {
        document.getElementById("dialogPlugin:btnEliminarPropiedad").click();
    }
</h:outputScript>
</ui:define>

<ui:define name="contentFooterDialogRight">
<p:commandButton action="#{dialogProcedimientoTramite.ayuda}"
                 icon="pi pi-info-circle" iconPos="top"
                 value="#{labels['dict.ayuda']}"
                 process="@this"/>
<p:commandButton action="#{dialogProcedimientoTramite.guardar}"
                 value="#{labels['dict.guardar']}" update="messagesDialog"
                 rendered="#{!dialogProcedimientoTramite.isModoConsulta()}"
                 process="@all"/>
<p:commandButton action="#{dialogProcedimientoTramite.cerrar}"
                 value="#{labels['dict.cerrar']}" update="messagesDialog"
                 process="@this"/>

</ui:define>
        </ui:composition>

        </html>
